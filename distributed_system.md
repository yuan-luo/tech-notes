Google Spanner Notes:

http://www.freeoa.net/scheme/manual/the-google-spanner_3241.html

Spanner的事务分为读写事务，只读事务(预先申明的快照隔离事务)以及快照读。

Spanner 用的 TrueTime 技术，依赖于原子钟和卫星来实现单调递增的全局时间戳。

Spanner使用Paxos协议在多个副本间同步redo日志，从而保证数据在多个副本上是一致的。Google的工程师钟情于Paxos协议，Chubby、Megastore和Spanner等一系列产品都是在Paxos协议的基础上实现一致性的。

Spanner 系统中的分布式事务通过两阶段提交协议2PC实现。2PC是一类特殊的一致性协议，假设一个分布式事务涉及了多个数据节点，2PC可以保证在这些节点上的操作要么全部提交，要么全部失败，从而保证了整个分布式事务的原子性ACID里的A。协议中包含两个角色：协调者coordinator和参与者participant/cohort。协调者是分布式事务的发起者，而参与者是参与了事务的数据节点。在协议最基本的形式中，系统中有一个协调者和多个参与者。

2PC最令人诟病之处还不在于性能，而是在有些故障条件下，会造成所有参与者占有读锁、写锁堵塞在第二阶段，需要人工干预才能继续，存在严重的可用性隐患。假设故障发生在第二阶段，协调者在做出决定后，通知完一个参与者就宕机了，更糟糕的是被通知的这位参与者在执行完“上级指示”之后也宕机了，这时对其他参与者来说，就必须堵塞在那里等待结果。

Spanner利用基于Paxos协议的复制技术，改善了2PC的可用性问题。2PC协议过程中的协调者和参与者生成的日志都会利用Paxos协议复制到所有副本中，这样无论是协调者或参与者宕机，都会有其他副本代替它们，完成2PC过程而不至于堵塞。在Paxos协议上实现2PC这一思路很巧妙，Paxos协议保证了大多数节点在线情况下的可用性，而2PC保证了分布式协议的一致性。


